---
name: review-prs
description: Review, approve, and merge GitHub pull requests. Handles Dependabot PRs with auto-merge rules and feature PRs with code review. Use when asked to "review PRs", "merge dependabot", "check pull requests", or "clean up PRs".
arguments: "[--repo owner/repo] [--auto-merge] [--dependabot-only] [--pr number]"
---

# PR Review Skill

Review, approve, and merge GitHub pull requests intelligently.

## Your Task

1. **Parse arguments**:
   - `--repo owner/repo` - Target repository (auto-detected if in git repo)
   - `--auto-merge` - Automatically merge PRs that pass review criteria
   - `--dependabot-only` - Only process Dependabot PRs
   - `--pr number` - Review a specific PR

2. **Detect repository** if not specified:
   ```bash
   gh repo view --json nameWithOwner -q .nameWithOwner
   ```

3. **List open PRs**:
   ```bash
   gh pr list --repo owner/repo --state open --json number,title,author,headRefName,createdAt,mergeable,statusCheckRollup,labels
   ```

4. **Categorize PRs** by type and process accordingly

## PR Categories

### 1. Dependabot PRs

Identify by: `author.login` contains "dependabot" or "renovate"

**Auto-merge criteria** (all must pass):
- CI checks pass (`statusCheckRollup` all success)
- No merge conflicts (`mergeable` is true)
- Change type is patch or minor (not major)

**Review process**:
```bash
# Get PR details
gh pr view NUMBER --repo owner/repo --json title,body,files,additions,deletions

# Check if it's a major version bump
# Parse title: "bump X from 1.0.0 to 2.0.0" - major if first number changes
```

**Risk assessment**:

| Pattern | Risk | Action |
|---------|------|--------|
| Patch: `1.0.0 ‚Üí 1.0.1` | Low | Auto-merge if CI passes |
| Minor: `1.0.0 ‚Üí 1.1.0` | Low-Medium | Auto-merge if CI passes |
| Major: `1.0.0 ‚Üí 2.0.0` | High | Review changelog, may need code changes |
| Security advisory | Critical | Prioritize, review carefully |
| Multiple deps in one PR | Medium | Review each dependency |

**For safe Dependabot PRs**:
```bash
# Approve
gh pr review NUMBER --repo owner/repo --approve --body "‚úÖ Auto-approved: Patch/minor update, CI passes

ü§ñ Reviewed by Ralph"

# Merge (if --auto-merge)
gh pr merge NUMBER --repo owner/repo --squash --delete-branch
```

**For risky Dependabot PRs**:
```bash
# Add comment explaining risk
gh pr comment NUMBER --repo owner/repo --body "‚ö†Ô∏è **Major version bump detected**

This PR updates X from v1 to v2. Major versions may include breaking changes.

**Recommended actions:**
1. Review the changelog: [link]
2. Check for breaking changes in your usage
3. Run full test suite locally

ü§ñ Flagged by Ralph"
```

### 2. Ralph-Generated PRs

Identify by: PR body contains "ü§ñ Generated by Ralph"

**Review process**:
1. Find linked GitHub issue from PR body (`Closes #X`)
2. Fetch original issue requirements
3. Compare implementation against acceptance criteria
4. Verify all stories were completed

```bash
# Get PR details
gh pr view NUMBER --json body,files,commits

# Get linked issue
gh issue view ISSUE_NUMBER --json title,body
```

**Review checklist**:
- [ ] All linked issues addressed
- [ ] Code changes match acceptance criteria
- [ ] No obvious bugs or issues
- [ ] Tests included (if applicable)
- [ ] CI passes

**If review passes**:
```bash
gh pr review NUMBER --approve --body "‚úÖ **Ralph PR Review**

All acceptance criteria met:
- [x] Criterion 1
- [x] Criterion 2

ü§ñ Reviewed by Ralph"
```

### 3. Human Feature PRs

Identify by: Not Dependabot and not Ralph-generated

**Review process**:
1. Read PR description and understand intent
2. Review code changes file by file
3. Check for:
   - Code quality and patterns
   - Potential bugs
   - Security issues
   - Test coverage
   - Documentation

```bash
# Get full diff
gh pr diff NUMBER --repo owner/repo

# Get file list
gh pr view NUMBER --json files
```

**Provide constructive feedback**:
```bash
gh pr review NUMBER --comment --body "## Code Review

### Summary
[Brief summary of changes]

### Feedback
- **file.ts:42** - Consider using X instead of Y
- **component.tsx** - Missing error handling for edge case

### Questions
- What's the expected behavior when...?

ü§ñ Reviewed by Ralph"
```

## Output Format

After processing PRs, provide a summary:

```
## PR Review Summary

### Auto-Merged (3)
- #12 ‚úÖ bump lucide-react 0.469.0 ‚Üí 0.562.0 (minor)
- #10 ‚úÖ bump email-validator 2.1.0 ‚Üí 2.3.0 (minor)
- #7 ‚úÖ bump python-multipart 0.0.6 ‚Üí 0.0.21 (patch)

### Approved, Pending Merge (1)
- #14 ‚úÖ Fix Composer Audio Playback (Ralph PR)

### Flagged for Human Review (2)
- #5 ‚ö†Ô∏è bump next 15.5.9 ‚Üí 16.1.1 (MAJOR)
- #1 ‚ö†Ô∏è bump python 3.12 ‚Üí 3.14 (MAJOR)

### Needs Work (0)

### Skipped (7)
- #2, #3, #4, #6, #8, #9, #11 - Await CI or other PRs
```

## Safety Rules

1. **Never force merge** - Only merge if all checks pass
2. **Never merge major bumps automatically** - Always flag for review
3. **Preserve PR history** - Use squash merge for cleaner history
4. **Delete branches after merge** - Keep repo clean
5. **Don't merge PRs with conflicts** - Flag for resolution

## Batch Processing

When processing multiple PRs:

1. **Process Dependabot first** - They're usually independent
2. **Process in dependency order** - Base packages before dependents
3. **Wait for CI between merges** - Don't overwhelm CI system
4. **Stop on failure** - If a merge fails, pause and report

```bash
# Check CI status before each merge
gh pr checks NUMBER --repo owner/repo
```

## Examples

```bash
# Review all PRs, auto-merge safe ones
claude /review-prs --auto-merge

# Just review Dependabot PRs
claude /review-prs --dependabot-only --auto-merge

# Review a specific PR
claude /review-prs --pr 14

# Review PRs in a different repo
claude /review-prs --repo owner/other-repo
```
