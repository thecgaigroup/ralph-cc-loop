{
  "project": "Fix Composer Audio Playback",
  "mode": "feature",
  "branchName": "ralph/fix-composer-audio-playback",
  "baseBranch": "main",
  "description": "Fix issue where composer shows completed but audio is not playable (GitHub Issue #13)",
  "githubRepo": "thecgaigroup/aimusicgenerator",
  "githubIssues": [13],
  "plugins": {
    "recommended": ["security-guidance", "commit-commands"],
    "optional": ["typescript-lsp"]
  },
  "userStories": [
    {
      "id": "GH-13-1",
      "githubIssue": 13,
      "title": "Handle S3 URLs by fetching presigned URLs from API",
      "description": "The makeAudioUrlAbsolute function returns raw s3:// URLs which browsers cannot play. Need to convert S3 URLs to presigned URLs via the backend API.",
      "acceptanceCriteria": [
        "S3 URLs (s3://...) are detected in makeAudioUrlAbsolute",
        "S3 URLs are converted to playable presigned URLs via API call",
        "Non-S3 URLs continue to work as before",
        "Typecheck passes"
      ],
      "files": [
        "apps/web/src/lib/url-utils.ts",
        "apps/web/src/lib/music-api.ts"
      ],
      "priority": 1,
      "passes": false,
      "notes": "The current code has a TODO comment acknowledging this issue"
    },
    {
      "id": "GH-13-2",
      "githubIssue": 13,
      "title": "Add error handling to AudioPlayer component",
      "description": "The AudioPlayer component has no error handling for failed audio loads. Users see a non-functional player with no feedback.",
      "acceptanceCriteria": [
        "Add onerror event listener to audio element",
        "Show error state when audio fails to load",
        "Display user-friendly error message",
        "Add retry button for failed loads",
        "Typecheck passes"
      ],
      "files": [
        "apps/web/src/components/ui/AudioPlayer.tsx"
      ],
      "dependsOn": ["GH-13-1"],
      "priority": 2,
      "passes": false,
      "notes": "Currently no feedback when audio.src is invalid"
    },
    {
      "id": "GH-13-3",
      "githubIssue": 13,
      "title": "Add authentication tokens to audio URLs",
      "description": "Protected audio resources may require authentication. The withAuthToken utility exists but is not being used for audio playback.",
      "acceptanceCriteria": [
        "Audio URLs include authentication token when needed",
        "Token is refreshed if expired before playback",
        "Works with both direct URLs and presigned S3 URLs",
        "Typecheck passes"
      ],
      "files": [
        "apps/web/src/components/ui/AudioPlayer.tsx",
        "apps/web/src/lib/url-utils.ts",
        "apps/web/src/store/useMusicStore.ts"
      ],
      "dependsOn": ["GH-13-1"],
      "priority": 3,
      "passes": false,
      "notes": "withAuthToken function exists in url-utils.ts but may not be used"
    },
    {
      "id": "GH-13-4",
      "githubIssue": 13,
      "title": "Verify audio is loadable before showing Complete status",
      "description": "The Step6Review shows 'Complete' badge when generatedAudio exists, but doesn't verify the audio URL is actually playable.",
      "acceptanceCriteria": [
        "Audio URL is validated before transitioning to step 6",
        "Loading state shown while verifying audio",
        "Error state if audio URL is invalid",
        "Only show 'Complete' badge when audio is confirmed playable",
        "Typecheck passes",
        "Verify in browser at /agents/composer"
      ],
      "files": [
        "apps/web/src/store/useMusicStore.ts",
        "apps/web/src/components/steps/Step6Review.tsx"
      ],
      "dependsOn": ["GH-13-1", "GH-13-2"],
      "priority": 4,
      "passes": false,
      "notes": "Adds pre-flight check for audio playability"
    }
  ]
}
